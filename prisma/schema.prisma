generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Availability {
  id           String    @id
  userId       String
  dayOfWeek    Int
  startTime    String
  endTime      String
  createdAt    DateTime  @default(now())
  isRecurring  Boolean   @default(true)
  specificDate DateTime?
  isPreferred  Boolean   @default(false)
  updatedAt    DateTime  @default(now())
  User         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, dayOfWeek])
}

model Location {
  id             String       @id
  name           String
  address        String
  organizationId String
  createdAt      DateTime     @default(now())
  latitude       Float?
  longitude      Float?
  geofenceRadius Int?         @default(250)
  Organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  Shift          Shift[]
  TimeEntry      TimeEntry[]
  User           User[]
}

model Organization {
  id                          String                 @id
  name                        String
  plan                        String                 @default("free")
  createdAt                   DateTime               @default(now())
  logoUrl                     String?
  onboardingCompleted         Boolean                @default(false)
  timezone                    String?                @default("America/New_York")
  updatedAt                   DateTime               @default(now())
  autoEndBeforeOvertime       Boolean                @default(false)
  breakPaid                   Boolean                @default(false)
  breaksEnabled               Boolean                @default(true)
  coworkersVisibleToEmployees Boolean                @default(true)
  defaultBreakMinutes         Int                    @default(30)
  earlyClockInMinutes         Int                    @default(15)
  employeesCanRequestTimeOff  Boolean                @default(true)
  employeesCanSwapShifts      Boolean                @default(true)
  employeesCanViewCoworkers   Boolean                @default(true)
  firstDayOfWeek              Int                    @default(1)
  geofencingEnabled           Boolean                @default(true)
  hoursOfOperationEnd         String                 @default("23:59")
  hoursOfOperationStart       String                 @default("00:00")
  lateClockInMinutes          Int                    @default(15)
  managersCanEditAllLocations Boolean                @default(false)
  overtimeThreshold           Int                    @default(40)
  roundingEnabled             Boolean                @default(false)
  roundingMinutes             Int                    @default(15)
  scheduleVisibleToEmployees  Boolean                @default(true)
  scheduleVisibleToManagers   Boolean                @default(true)
  swapRequiresApproval        Boolean                @default(false)
  timeClockEnabled            Boolean                @default(true)
  timeOffVisibleToEmployees   Boolean                @default(true)
  Location                    Location[]
  SchedulingPreferences       SchedulingPreferences?
  User                        User[]
}

model SchedulingPreferences {
  id                        String       @id
  organizationId            String       @unique
  defaultMaxHoursPerWeek    Int          @default(40)
  defaultMaxConsecutiveDays Int          @default(6)
  defaultMinRestHours       Int          @default(8)
  preferredLocationWeight   Float        @default(1.2)
  costOptimizationEnabled   Boolean      @default(true)
  fairDistributionEnabled   Boolean      @default(true)
  autoAssignEnabled         Boolean      @default(false)
  minScoreThreshold         Int          @default(60)
  createdAt                 DateTime     @default(now())
  updatedAt                 DateTime
  Organization              Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
}

model Shift {
  id                                                   String             @id
  startTime                                            DateTime
  endTime                                              DateTime
  userId                                               String?
  locationId                                           String
  role                                                 String
  status                                               ShiftStatus        @default(DRAFT)
  notes                                                String?
  createdAt                                            DateTime           @default(now())
  updatedAt                                            DateTime
  breakMinutes                                         Int                @default(30)
  hourlyRate                                           Float?
  minSeniority                                         Int?
  priority                                             Int                @default(0)
  requiredSkills                                       String[]           @default([])
  shiftType                                            String?
  Location                                             Location           @relation(fields: [locationId], references: [id], onDelete: Cascade)
  User                                                 User?              @relation(fields: [userId], references: [id])
  ShiftSwapRequest_ShiftSwapRequest_fromShiftIdToShift ShiftSwapRequest[] @relation("ShiftSwapRequest_fromShiftIdToShift")
  ShiftSwapRequest_ShiftSwapRequest_toShiftIdToShift   ShiftSwapRequest[] @relation("ShiftSwapRequest_toShiftIdToShift")
  TimeEntry                                            TimeEntry[]
  TipRecord                                            TipRecord[]
}

model ShiftSwapRequest {
  id                                        String     @id
  fromShiftId                               String
  toShiftId                                 String
  requestedById                             String
  status                                    SwapStatus @default(PENDING)
  autoApproved                              Boolean    @default(false)
  reason                                    String?
  createdAt                                 DateTime   @default(now())
  updatedAt                                 DateTime
  Shift_ShiftSwapRequest_fromShiftIdToShift Shift      @relation("ShiftSwapRequest_fromShiftIdToShift", fields: [fromShiftId], references: [id], onDelete: Cascade)
  User                                      User       @relation(fields: [requestedById], references: [id], onDelete: Cascade)
  Shift_ShiftSwapRequest_toShiftIdToShift   Shift      @relation("ShiftSwapRequest_toShiftIdToShift", fields: [toShiftId], references: [id], onDelete: Cascade)
}

model ShiftTemplate {
  id             String   @id
  organizationId String
  name           String
  dayOfWeek      Int
  startTime      String
  endTime        String
  role           String
  locationId     String?
  breakMinutes   Int      @default(30)
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
}

model TimeEntry {
  id         String    @id
  userId     String
  shiftId    String?
  clockIn    DateTime
  clockOut   DateTime?
  clockInLat Float?
  clockInLng Float?
  locationId String
  notes      String?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime
  Location   Location  @relation(fields: [locationId], references: [id], onDelete: Cascade)
  Shift      Shift?    @relation(fields: [shiftId], references: [id])
  User       User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model TimeOffRequest {
  id                                   String        @id
  userId                               String
  startDate                            DateTime
  endDate                              DateTime
  reason                               String?
  status                               TimeOffStatus @default(PENDING)
  reviewedBy                           String?
  createdAt                            DateTime      @default(now())
  updatedAt                            DateTime
  User_TimeOffRequest_reviewedByToUser User?         @relation("TimeOffRequest_reviewedByToUser", fields: [reviewedBy], references: [id])
  User_TimeOffRequest_userIdToUser     User          @relation("TimeOffRequest_userIdToUser", fields: [userId], references: [id], onDelete: Cascade)
}

model TipRecord {
  id        String   @id
  userId    String
  shiftId   String?
  amount    Float
  date      DateTime
  createdAt DateTime @default(now())
  Shift     Shift?   @relation(fields: [shiftId], references: [id])
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UnavailableDate {
  id        String   @id
  userId    String
  date      DateTime
  allDay    Boolean  @default(true)
  startTime String?
  endTime   String?
  reason    String?
  createdAt DateTime @default(now())
  updatedAt DateTime
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, date])
}

model User {
  id                                             String             @id
  email                                          String             @unique
  name                                           String
  password                                       String?
  role                                           Role               @default(EMPLOYEE)
  organizationId                                 String
  createdAt                                      DateTime           @default(now())
  updatedAt                                      DateTime
  defaultHourlyRate                              Float?
  emailVerified                                  Boolean            @default(false)
  hireDate                                       DateTime?
  maxHoursPerWeek                                Int?
  phone                                          String?
  phoneVerified                                  Boolean            @default(false)
  position                                       String?
  profilePicture                                 String?
  timezone                                       String?            @default("America/New_York")
  isFullTime                                     Boolean            @default(false)
  maxConsecutiveDays                             Int?               @default(6)
  minHoursPerWeek                                Int?
  minRestHours                                   Int?               @default(8)
  preferredLocationId                            String?
  seniority                                      Int?               @default(0)
  shiftTypePreferences                           String[]           @default([])
  skills                                         String[]           @default([])
  emailNotifications                             Boolean            @default(true)
  schedulePublishedNotifications                 Boolean            @default(true)
  shiftReminderHours                             Int                @default(24)
  smsNotifications                               Boolean            @default(false)
  swapRequestNotifications                       Boolean            @default(true)
  Availability                                   Availability[]
  Shift                                          Shift[]
  ShiftSwapRequest                               ShiftSwapRequest[]
  TimeEntry                                      TimeEntry[]
  TimeOffRequest_TimeOffRequest_reviewedByToUser TimeOffRequest[]   @relation("TimeOffRequest_reviewedByToUser")
  TimeOffRequest_TimeOffRequest_userIdToUser     TimeOffRequest[]   @relation("TimeOffRequest_userIdToUser")
  TipRecord                                      TipRecord[]
  UnavailableDate                                UnavailableDate[]
  Organization                                   Organization       @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  Location                                       Location?          @relation(fields: [preferredLocationId], references: [id])
}

model verification_tokens {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

enum Role {
  OWNER
  MANAGER
  EMPLOYEE
}

enum ShiftStatus {
  DRAFT
  PUBLISHED
  CONFIRMED
  CANCELLED
}

enum SwapStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

enum TimeOffStatus {
  PENDING
  APPROVED
  DENIED
}
